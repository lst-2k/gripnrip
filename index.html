<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LST-74 Grip&Rip Divisional Season</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root { 
            --div1: #0047AB; --div2: #008B8B; --div3: #D2691E; --gold: #FFD700; 
            --header-grad: linear-gradient(135deg, #7C7C7C 0%, #545454 100%); 
            --info-grad: linear-gradient(135deg, #7C7C7C 0%, #545454 100%);
        }
        body { background-color: #f0f2f5; margin: 10px; font-family: 'Segoe UI', sans-serif; font-size: 16px; overflow-x: hidden; }
        .leaderboard-container { max-width: 1600px; margin: 0 auto 20px auto; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .header { background: var(--header-grad); color: white; padding: 25px 15px; text-align: center; border-bottom: 4px solid var(--gold); }
        .header-title { font-size: 22px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .info-bar { display: flex; justify-content: center; gap: 20px; background: var(--info-grad); color: #fff; padding: 15px; border-bottom: 1px solid #444; font-size: 14px; }
        .editable-label { color: var(--gold); font-weight: 800; margin-right: 5px; text-transform: uppercase; }
        
        /* Centered Division Headings */
        .div-header { color: white; padding: 12px 15px; font-size: 20px; font-weight: bold; text-transform: uppercase; text-align: center; letter-spacing: 1px; }
        .div-1 { background: var(--div1); } .div-2 { background: var(--div2); } .div-3 { background: var(--div3); } 
        
        .table-wrapper { width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch; }
        table { width: 100%; border-collapse: collapse; min-width: 850px; } 
        thead th { background: #f4f4f4; font-size: 11px; padding: 12px 5px; text-transform: uppercase; border-bottom: 2px solid #ddd; }
        td { padding: 12px 6px; text-align: center; border-bottom: 1px solid #eee; font-size: 15px; white-space: nowrap; }
        .name-col-cell { display: flex; align-items: center; gap: 10px; text-align: left; padding-left: 10px; }
        .pts-col { font-weight: 900; color: #333; background: #fafafa; }
        .season-header { background: #7C7C7C; color: white; padding: 15px; font-size: 22px; font-weight: 900; text-align: center; text-transform: uppercase; border-bottom: 2px solid var(--gold); }
        .up { color: #28a745; } .down { color: #dc3545; } .steady { color: #999; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div id="main-container" class="leaderboard-container">
        <div class="header">
            <div class="header-title">LST-74 Grip&Rip Divisional Season</div>
        </div>
        <div class="info-bar">
            <div class="info-item"><span class="editable-label">Venue:</span><span id="course-venue">...</span></div>
            <div class="info-item"><span class="editable-label">Par:</span><span id="course-par">--</span></div>
        </div>
        <div id="div-container"></div>
    </div>

    <div class="leaderboard-container">
        <div class="season-header">Season Standings</div>
        <div id="season-container"></div>
    </div>

    <script>
        let state = { players: [], showR3R4: false, par: 72, venue: '' };

        async function loadData() {
            try {
                const response = await fetch('data.json?t=' + Date.now());
                state = await response.json();
                render();
            } catch (e) {
                document.getElementById('div-container').innerHTML = "<div style='padding:40px; text-align:center;'>Waiting for tournament data...</div>";
            }
        }

        function getScore(p) {
            let t = (Number(p.r1)||0) + (Number(p.r2)||0);
            if(state.showR3R4) t += (Number(p.r3)||0) + (Number(p.r4)||0);
            return t;
        }

        function countRounds(p) {
            let c = 0;
            if (Number(p.r1) > 0) c++; if (Number(p.r2) > 0) c++;
            if (state.showR3R4) { if (Number(p.r3) > 0) c++; if (Number(p.r4) > 0) c++; }
            return c;
        }

        const getPlatIcon = (p) => {
            if (p === 'xbox') return '<i class="fa-brands fa-xbox" style="color:#107C10"></i>';
            if (p === 'playstation') return '<i class="fa-brands fa-playstation" style="color:#003087"></i>';
            return '<i class="fa-brands fa-steam"></i>';
        };

        function render() {
            document.getElementById('course-venue').innerText = state.venue;
            document.getElementById('course-par').innerText = state.par;
            const container = document.getElementById('div-container');
            container.innerHTML = '';
            
            [1, 2, 3].forEach(divNum => {
                let dps = state.players.filter(p => String(p.division) === String(divNum));
                dps.sort((a,b) => (countRounds(b) - countRounds(a)) || (getScore(a) - getScore(b)));

                const divBox = document.createElement('div');
                divBox.innerHTML = `
                <div class="div-header div-${divNum}">Division ${divNum}</div>
                <div class="table-wrapper">
                    <table>
                        <thead><tr>
                            <th style="width:50px">POS</th>
                            <th style="text-align:left; padding-left:20px; width:200px;">PLAYER</th>
                            <th style="width:50px">PAR</th>
                            <th style="width:50px">R1</th><th style="width:50px">R2</th>
                            <th style="width:50px" class="${state.showR3R4 ? '' : 'hidden'}">R3</th>
                            <th style="width:50px" class="${state.showR3R4 ? '' : 'hidden'}">R4</th>
                            <th style="width:60px">TOTAL</th>
                            <th style="width:100px">LONG PUTT</th>
                            <th style="width:100px">LONG HOLE</th>
                            <th class="pts-col" style="width:60px">PTS</th>
                        </tr></thead>
                        <tbody>${dps.map((p, idx) => {
                            const score = getScore(p);
                            const rds = countRounds(p);
                            const toPar = score - (state.par * rds);
                            const parText = rds === 0 ? '-' : (toPar === 0 ? 'E' : (toPar > 0 ? '+' + toPar : toPar));
                            return `<tr>
                                <td>${rds > 0 ? (idx + 1) : '-'}</td>
                                <td><div class="name-col-cell"><span>${getPlatIcon(p.platform)}</span><span>${p.name}</span></div></td>
                                <td style="font-weight:bold; color:${toPar < 0 ? 'red' : 'black'}">${parText}</td>
                                <td>${p.r1 || '-'}</td><td>${p.r2 || '-'}</td>
                                <td class="${state.showR3R4 ? '' : 'hidden'}">${p.r3 || '-'}</td>
                                <td class="${state.showR3R4 ? '' : 'hidden'}">${p.r4 || '-'}</td>
                                <td style="font-weight:bold">${score > 0 ? score : '-'}</td>
                                <td>${p.putt ? p.putt + 'ft' : '-'}</td>
                                <td>${p.hole ? p.hole + 'yd' : '-'}</td>
                                <td class="pts-col">-</td>
                            </tr>`;
                        }).join('')}</tbody>
                    </table>
                </div>`;
                container.appendChild(divBox);
            });
            renderSeason();
        }

        function renderSeason() {
            const container = document.getElementById('season-container');
            container.innerHTML = '';
            [1, 2, 3].forEach(divNum => {
                let dps = state.players.filter(p => String(p.division) === String(divNum));
                dps.sort((a,b) => (b.seasonPts || 0) - (a.seasonPts || 0));
                if (dps.length === 0) return;
                const rowsHtml = dps.map((p, idx) => {
                    let changeIcon = '<span class="steady">—</span>';
                    if (p.prevRank) {
                        if (idx + 1 < p.prevRank) changeIcon = '<span class="up">▲</span>';
                        else if (idx + 1 > p.prevRank) changeIcon = '<span class="down">▼</span>';
                    }
                    return `<tr>
                        <td>${changeIcon}</td>
                        <td>${idx+1}</td>
                        <td style="text-align:left; padding-left:20px;"><div class="name-col-cell"><span>${getPlatIcon(p.platform)}</span>${p.name}</div></td>
                        <td class="pts-col">${p.seasonPts || 0}</td>
                    </tr>`;
                }).join('');
                const divBox = document.createElement('div');
                divBox.innerHTML = `
                <div class="div-header div-${divNum}">Division ${divNum} Standings</div>
                <div class="table-wrapper">
                    <table>
                        <thead><tr><th style="width:50px">+/-</th><th style="width:50px">RANK</th><th style="text-align:left; padding-left:20px;">PLAYER</th><th style="width:80px">PTS</th></tr></thead>
                        <tbody>${rowsHtml}</tbody>
                    </table>
                </div>`;
                container.appendChild(divBox);
            });
        }
        loadData();
    </script>
</body>
</html>